{% extends "pierwsza_app/base.html" %}
{% block title %}Profil: {{ employee.name }}{% endblock %}
{% block content %}

<h1>Profil: {{ employee.name }}</h1>

{% if info %}<div class="flash">{{ info }}</div>{% endif %}
{% if error %}<div class="flash" style="border-color:#e99;background:#fff5f5;">{{ error }}</div>{% endif %}

<form method="post" style="max-width:700px;">
  {% csrf_token %}

  <label class="muted" for="name">Imię i nazwisko</label>
  <input id="name" name="name" type="text" value="{{ employee.name }}" required>

  <div style="height:10px;"></div>

  <label class="muted" for="position">Stanowisko</label>
  <input id="position" name="position" type="text" value="{{ employee.position }}">

  <div style="height:10px;"></div>

  <label class="muted" for="contact">Kontakt (telefon/opis)</label>
  <input id="contact" name="contact" type="text" value="{{ employee.contact }}">

  <div style="height:10px;"></div>

  <label class="muted" for="email">Kontakt e-mail</label>
  <input id="email" name="email" type="email" value="{{ employee.email }}">

  <div style="height:10px;"></div>

  <label class="muted" for="medical_exam">Termin badań lekarskich</label>
  <input id="medical_exam" name="medical_exam" type="date" value="{{ employee.medical_exam }}">

  <hr>

  {# --- UMIĘJĘTNOŚCI (zwijane) --- #}
  {% with checked_count=emp_skills_on|length %}
  <details style="border:1px solid var(--border);border-radius:10px;padding:10px;background:#fff;">
    <summary style="cursor:pointer;list-style:none;display:flex;align-items:center;gap:10px;">
      <strong>Doświadczenie / umiejętności</strong>
      <span class="muted">— zaznaczone: {{ checked_count }} / {{ skills_catalog|length }}</span>
    </summary>

    <div style="height:10px;"></div>

    <div class="skills-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:8px;">
      {% for sk in skills_catalog %}
      <div class="skill-chip" style="display:flex;align-items:center;gap:8px;border:1px solid var(--border);border-radius:8px;padding:6px 10px;background:#fafafa;">
        <label style="display:flex;align-items:center;gap:8px;flex:1 1 auto;">
          <input type="checkbox" name="skills" value="{{ sk }}" {% if sk in emp_skills_on %}checked{% endif %}>
          <span>{{ sk }}</span>
        </label>
        <button type="submit"
                name="delete_skill"
                value="{{ sk }}"
                title="Usuń z katalogu globalnego"
                style="border:1px solid #fecaca;background:#fff5f5;color:#b91c1c;border-radius:6px;padding:0 8px;line-height:26px;cursor:pointer;">
          ×
        </button>
      </div>
      {% empty %}
      <div class="muted">Brak zdefiniowanych umiejętności.</div>
      {% endfor %}
    </div>

    <div style="height:10px;"></div>

    <label class="muted" for="new_skill">Dodaj nową umiejętność (globalnie)</label>
    <input id="new_skill" name="new_skill" type="text" placeholder="np. Wózek widłowy">
    <small class="muted">Po zapisaniu doda się do katalogu globalnego i zaznaczy u tego pracownika.</small>
  </details>
  {% endwith %}

  <div style="height:14px;"></div>

  <button class="btn" type="submit">Zapisz</button>
  <a class="btn" href="{% url 'panel' group %}">Anuluj</a>
</form>

{% endblock %}
